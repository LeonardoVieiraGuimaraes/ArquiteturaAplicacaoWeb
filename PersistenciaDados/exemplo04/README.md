# Exemplo 04 - Salvamento em MariaDB (XAMPP Docker)

## Descri√ß√£o
Este exemplo demonstra como criar uma API REST utilizando Spring Boot com persist√™ncia permanente de dados em **MariaDB**, um banco de dados relacional robusto e de c√≥digo aberto. Os dados s√£o armazenados permanentemente e podem ser consultados mesmo ap√≥s reiniciar a aplica√ß√£o.

**üê≥ Novidade**: Agora com **XAMPP em Docker** - o pacote completo Apache + MariaDB + PHP + PHPMyAdmin em um √∫nico container!

## Tecnologias Utilizadas
- **Java 23**
- **Spring Boot 3.4.3**
- **Spring Web** - Para cria√ß√£o de APIs REST
- **Spring Data JPA** - Para persist√™ncia de dados com JPA/Hibernate
- **MariaDB** - Banco de dados relacional
- **Maven** - Gerenciamento de depend√™ncias

## Estrutura do Projeto
```
exemplo04/demo/
‚îú‚îÄ‚îÄ src/main/java/com/example/demo/
‚îÇ   ‚îú‚îÄ‚îÄ DemoApplication.java          # Classe principal
‚îÇ   ‚îú‚îÄ‚îÄ controller/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ HelloController.java      # Controller simples
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProductController.java    # Controller de produtos
‚îÇ   ‚îú‚îÄ‚îÄ service/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProductService.java       # L√≥gica de neg√≥cio
‚îÇ   ‚îú‚îÄ‚îÄ repository/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProductRepository.java    # Interface JPA Repository
‚îÇ   ‚îî‚îÄ‚îÄ model/
‚îÇ       ‚îî‚îÄ‚îÄ Product.java              # Entidade JPA Product
‚îî‚îÄ‚îÄ src/main/resources/
    ‚îî‚îÄ‚îÄ application.properties        # Configura√ß√µes do MariaDB
```

## Caracter√≠sticas

### Persist√™ncia com MariaDB
- Banco de dados SQL relacional permanente
- Dados armazenados de forma dur√°vel no disco
- IDs auto-incrementados pelo banco de dados
- Suporte completo a transa√ß√µes ACID
- Escal√°vel e adequado para produ√ß√£o

### Entidade Product
```java
@Entity
@Table(name = "products")
public class Product {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    private String name;
    // Getters e Setters
}
```

### Repository Pattern
Interface `ProductRepository` que estende `JpaRepository`:
```java
public interface ProductRepository extends JpaRepository<Product, Long> {
    Optional<Product> findByName(String name);
}
```

## Configura√ß√£o do MariaDB

### application.properties
```properties
spring.application.name=demo

# MariaDB Configuration
spring.datasource.url=jdbc:mariadb://localhost:3306/productdb
spring.datasource.username=root
spring.datasource.password=root
spring.datasource.driver-class-name=org.mariadb.jdbc.Driver

# JPA/Hibernate
spring.jpa.database-platform=org.hibernate.dialect.MariaDBDialect
spring.jpa.hibernate.ddl-auto=update
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
```

## Pr√©-requisitos

### üê≥ Op√ß√£o 1: Usando Docker (Recomendado - Mais F√°cil!)

**Requisitos**:
- Docker Desktop instalado
- Docker Compose (inclu√≠do no Docker Desktop)

**Vantagens**:
- ‚úÖ N√£o precisa instalar MariaDB manualmente
- ‚úÖ Configura√ß√£o autom√°tica do banco de dados
- ‚úÖ Inclui PHPMyAdmin para gerenciamento visual
- ‚úÖ Isolado do sistema (n√£o interfere com outros bancos)
- ‚úÖ F√°cil de iniciar e parar

**Instala√ß√£o do Docker**:
- Windows: https://docs.docker.com/desktop/install/windows-install/
- Ou via Chocolatey: `choco install docker-desktop`

---

### üì¶ Op√ß√£o 2: Instala√ß√£o Manual do MariaDB

#### Windows (usando Chocolatey):
```powershell
choco install mariadb
```

#### Ou baixe do site oficial:
- https://mariadb.org/download/

#### Linux (Ubuntu/Debian):
```bash
sudo apt update
sudo apt install mariadb-server
```

#### macOS (usando Homebrew):
```bash
brew install mariadb
```

### 2. Iniciar MariaDB (Apenas se n√£o usar Docker)

#### Windows:
O servi√ßo inicia automaticamente ap√≥s a instala√ß√£o.

#### Linux:
```bash
sudo systemctl start mariadb
sudo systemctl enable mariadb
```

#### macOS:
```bash
brew services start mariadb
```

### 3. Configurar MariaDB (Apenas se n√£o usar Docker)

#### Acessar o console:
```bash
mysql -u root -p
```

#### Criar o banco de dados:
```sql
CREATE DATABASE productdb;
```

#### Criar usu√°rio (opcional):
```sql
CREATE USER 'appuser'@'localhost' IDENTIFIED BY 'senha123';
GRANT ALL PRIVILEGES ON productdb.* TO 'appuser'@'localhost';
FLUSH PRIVILEGES;
```

#### Verificar banco criado:
```sql
SHOW DATABASES;
USE productdb;
```

---

## üê≥ Como Executar com Docker (Recomendado)

### 1. Iniciar o MariaDB e PHPMyAdmin com Docker Compose
```powershell
cd exemplo04
docker-compose up -d
```

**O que acontece:**
- ‚úÖ MariaDB ser√° iniciado na porta `3306`
- ‚úÖ PHPMyAdmin ser√° iniciado na porta `8081`
- ‚úÖ Database `productdb` ser√° criado automaticamente
- ‚úÖ Script `init.sql` ser√° executado automaticamente

### 2. Verificar se os containers est√£o rodando
```powershell
docker-compose ps
```

**Voc√™ deve ver:**
```
NAME                     STATUS
exemplo04-mariadb        Up (healthy)
exemplo04-phpmyadmin     Up
```

### 3. Acessar o PHPMyAdmin (Gerenciador Visual)
Abra o navegador em: **http://localhost:8081**

**Credenciais:**
- Servidor: `mariadb`
- Usu√°rio: `root`
- Senha: `root`

### 4. Navegar at√© o projeto Spring Boot
```powershell
cd demo
```

### 5. Compilar o projeto
```powershell
mvn clean install -DskipTests
```

### 6. Executar a aplica√ß√£o
```powershell
java -jar .\target\demo-0.0.1-SNAPSHOT.jar
```

### 7. A aplica√ß√£o estar√° dispon√≠vel em: `http://localhost:8080`

### 8. Parar os containers (quando terminar)
```powershell
cd ..
docker-compose down
```

**Para parar E deletar os dados:**
```powershell
docker-compose down -v
```

---

## üì¶ Como Executar com Instala√ß√£o Manual

### 1. Certifique-se de que o MariaDB est√° rodando
(Veja se√ß√£o "Iniciar MariaDB" acima)

### 2. Crie o banco de dados
(Veja se√ß√£o "Configurar MariaDB" acima)

### 3. Navegue at√© o projeto
```powershell
cd PersistenciaDados\exemplo04\demo
```

### 4. Compile o projeto
```powershell
mvn clean install
```

### 5. Execute a aplica√ß√£o
```powershell
java -jar .\target\demo-0.0.1-SNAPSHOT.jar
```

### 6. A aplica√ß√£o estar√° dispon√≠vel em: `http://localhost:8080`

---

## Endpoints Dispon√≠veis

### 1. Listar todos os produtos
```http
GET http://localhost:8080/products
```

### 2. Buscar produto por ID
```http
GET http://localhost:8080/products/{id}
```

### 3. Buscar produto por nome
```http
GET http://localhost:8080/products/name/{name}
```

### 4. Adicionar novo produto
```http
POST http://localhost:8080/products
Content-Type: application/json

{
    "name": "Notebook"
}
```

### 5. Atualizar produto
```http
PUT http://localhost:8080/products/{id}
Content-Type: application/json

{
    "name": "Notebook Gamer"
}
```

### 6. Deletar produto
```http
DELETE http://localhost:8080/products/{id}
```

## Como Executar

### 1. Certifique-se de que o MariaDB est√° rodando
```powershell
# Windows - Verificar servi√ßo
Get-Service -Name MariaDB

# Linux
sudo systemctl status mariadb
```

### 2. Crie o banco de dados
```sql
CREATE DATABASE IF NOT EXISTS productdb;
```

### 3. Navegue at√© a pasta do projeto
```powershell
cd PersistenciaDados\exemplo04\demo
```

### 4. Configure as credenciais no application.properties
Edite o arquivo e ajuste usu√°rio/senha conforme sua instala√ß√£o:
```properties
spring.datasource.username=root
spring.datasource.password=sua_senha
```

### 5. Compile o projeto
```powershell
mvn clean install
```

### 6. Execute a aplica√ß√£o
```powershell
mvn spring-boot:run
```

### 7. A aplica√ß√£o estar√° dispon√≠vel em: `http://localhost:8080`

## Testando a API

### Usando cURL

**Adicionar produto:**
```powershell
curl -X POST http://localhost:8080/products `
  -H "Content-Type: application/json" `
  -d '{\"name\":\"Mouse\"}'
```

**Listar produtos:**
```powershell
curl http://localhost:8080/products
```

**Buscar produto por ID:**
```powershell
curl http://localhost:8080/products/1
```

**Buscar produto por nome:**
```powershell
curl http://localhost:8080/products/name/Mouse
```

**Atualizar produto:**
```powershell
curl -X PUT http://localhost:8080/products/1 `
  -H "Content-Type: application/json" `
  -d '{\"name\":\"Mouse Gamer\"}'
```

**Deletar produto:**
```powershell
curl -X DELETE http://localhost:8080/products/1
```

## Comandos MariaDB √öteis

### Conectar ao MariaDB
```bash
mysql -u root -p
```

### Usar o banco de dados
```sql
USE productdb;
```

### Listar todos os produtos
```sql
SELECT * FROM products;
```

### Inserir produto manualmente
```sql
INSERT INTO products (name) VALUES ('Teclado Mec√¢nico');
```

### Atualizar produto
```sql
UPDATE products SET name = 'Teclado RGB' WHERE id = 1;
```

### Deletar produto
```sql
DELETE FROM products WHERE id = 1;
```

### Contar produtos
```sql
SELECT COUNT(*) FROM products;
```

### Ver estrutura da tabela
```sql
DESCRIBE products;
```

### Deletar todos os dados (cuidado!)
```sql
TRUNCATE TABLE products;
```

## Vantagens do MariaDB
- ‚úÖ Persist√™ncia permanente de dados
- ‚úÖ Banco de dados robusto e confi√°vel
- ‚úÖ Suporte a transa√ß√µes ACID
- ‚úÖ C√≥digo aberto e gratuito
- ‚úÖ Compat√≠vel com MySQL
- ‚úÖ Alto desempenho
- ‚úÖ Adequado para produ√ß√£o
- ‚úÖ Escal√°vel
- ‚úÖ Grande comunidade e documenta√ß√£o

## Desvantagens
- ‚ùå Requer instala√ß√£o e configura√ß√£o
- ‚ùå Maior consumo de recursos que H2
- ‚ùå Necessita gerenciamento (backup, manuten√ß√£o)

## Quando Usar MariaDB
- Aplica√ß√µes em produ√ß√£o
- Dados que precisam persistir permanentemente
- Aplica√ß√µes que requerem transa√ß√µes complexas
- Sistemas com m√∫ltiplos usu√°rios concorrentes
- Quando precisar de um banco relacional robusto
- Aplica√ß√µes enterprise

## Compara√ß√£o dos 4 Exemplos

| Aspecto | Exemplo 01 | Exemplo 02 | Exemplo 03 | Exemplo 04 |
|---------|-----------|-----------|-----------|-----------|
| **Tipo** | Lista | NoSQL | SQL em mem√≥ria | SQL permanente |
| **Persist√™ncia** | ‚ùå N√£o | ‚úÖ Sim | ‚ùå N√£o | ‚úÖ Sim |
| **Banco** | Nenhum | MongoDB | H2 | MariaDB |
| **ID** | Long | String | Long | Long |
| **Repository** | ‚ùå | MongoRepository | JpaRepository | JpaRepository |
| **Service** | ‚ùå | ‚úÖ | ‚úÖ | ‚úÖ |
| **SQL** | ‚ùå | ‚ùå | ‚úÖ | ‚úÖ |
| **Produ√ß√£o** | ‚ùå | ‚úÖ | ‚ùå | ‚úÖ |
| **Instala√ß√£o** | N√£o requer | Requer | N√£o requer | Requer |
| **Complexidade** | Baixa | M√©dia | Baixa | M√©dia |

## Estrutura de Dados no MariaDB

### Tabela products
```sql
CREATE TABLE products (
  id BIGINT AUTO_INCREMENT PRIMARY KEY,
  name VARCHAR(255)
);
```

### Exemplo de dados:
```
+----+-------------------+
| id | name              |
+----+-------------------+
|  1 | Notebook          |
|  2 | Mouse Gamer       |
|  3 | Teclado Mec√¢nico  |
+----+-------------------+
```

## Seguran√ßa

### Boas Pr√°ticas:
1. **N√£o commite senhas no c√≥digo**
   - Use vari√°veis de ambiente
   - Configure em application.properties local

2. **Use usu√°rios espec√≠ficos**
   ```sql
   CREATE USER 'appuser'@'localhost' IDENTIFIED BY 'senha_forte';
   GRANT ALL ON productdb.* TO 'appuser'@'localhost';
   ```

3. **Configura√ß√£o com vari√°veis de ambiente**
   ```properties
   spring.datasource.username=${DB_USERNAME:root}
   spring.datasource.password=${DB_PASSWORD:root}
   ```

## Migra√ß√£o entre Bancos

Gra√ßas ao JPA, migrar entre bancos SQL √© simples! Basta alterar o `application.properties`:

### Para MySQL:
```properties
spring.datasource.url=jdbc:mysql://localhost:3306/productdb
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver
spring.jpa.database-platform=org.hibernate.dialect.MySQLDialect
```

### Para PostgreSQL:
```properties
spring.datasource.url=jdbc:postgresql://localhost:5432/productdb
spring.datasource.driver-class-name=org.postgresql.Driver
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect
```

O c√≥digo Java permanece inalterado!

## Backup e Restaura√ß√£o

### Fazer backup:
```bash
mysqldump -u root -p productdb > backup.sql
```

### Restaurar backup:
```bash
mysql -u root -p productdb < backup.sql
```

## Monitoramento

### Ver conex√µes ativas:
```sql
SHOW PROCESSLIST;
```

### Ver status do servidor:
```sql
SHOW STATUS;
```

### Ver vari√°veis de configura√ß√£o:
```sql
SHOW VARIABLES;
```

## Troubleshooting

### Erro: "Access denied for user"
- Verifique usu√°rio e senha no application.properties
- Certifique-se de que o usu√°rio tem permiss√µes no banco

### Erro: "Unknown database 'productdb'"
- Crie o banco: `CREATE DATABASE productdb;`

### Erro: "Communications link failure"
- Verifique se o MariaDB est√° rodando
- Verifique se a porta 3306 est√° correta
- Verifique firewall

### Erro: "Table doesn't exist"
- Verifique `spring.jpa.hibernate.ddl-auto=update`
- O Hibernate cria automaticamente as tabelas

## Pr√≥ximos Passos
- Implementar valida√ß√µes com Bean Validation
- Adicionar pagina√ß√£o e ordena√ß√£o
- Criar testes unit√°rios e de integra√ß√£o
- Implementar seguran√ßa (Spring Security)
- Adicionar cache com Redis
- Implementar audit com @CreatedDate e @LastModifiedDate

## Recursos Adicionais
- [MariaDB Documentation](https://mariadb.org/documentation/)
- [Spring Data JPA](https://spring.io/projects/spring-data-jpa)
- [Hibernate ORM](https://hibernate.org/orm/)

## Autor
Curso de Arquitetura de Aplica√ß√£o Web - Newton Paiva

## Licen√ßa
Este projeto √© livre para uso educacional.
